import{I as j,E as it,B as ut,g as W,U as Q,a as ct,h as D,F as E,S as z,G as rt,d as lt,f as ft,i as gt,V as X,M as x,C as mt,c as H,j as $,D as Y}from"./IllegalStateException.0671f9fd.js";class L{constructor(t){if(this.binarizer=t,t===null)throw new j("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(t,e){return this.binarizer.getBlackRow(t,e)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(t,e,i,s){const o=this.binarizer.getLuminanceSource().crop(t,e,i,s);return new L(this.binarizer.createBinarizer(o))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new L(this.binarizer.createBinarizer(t))}rotateCounterClockwise45(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new L(this.binarizer.createBinarizer(t))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class U extends it{static getChecksumInstance(){return new U}}class wt{constructor(t){this.source=t}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class A extends it{static getNotFoundInstance(){return new A}}class y extends wt{constructor(t){super(t),this.luminances=y.EMPTY,this.buckets=new Int32Array(y.LUMINANCE_BUCKETS)}getBlackRow(t,e){const i=this.getLuminanceSource(),s=i.getWidth();e==null||e.getSize()<s?e=new ut(s):e.clear(),this.initArrays(s);const o=i.getRow(t,this.luminances),n=this.buckets;for(let a=0;a<s;a++)n[(o[a]&255)>>y.LUMINANCE_SHIFT]++;const r=y.estimateBlackPoint(n);if(s<3)for(let a=0;a<s;a++)(o[a]&255)<r&&e.set(a);else{let a=o[0]&255,c=o[1]&255;for(let l=1;l<s-1;l++){const d=o[l+1]&255;(c*4-a-d)/2<r&&e.set(l),a=c,c=d}}return e}getBlackMatrix(){const t=this.getLuminanceSource(),e=t.getWidth(),i=t.getHeight(),s=new W(e,i);this.initArrays(e);const o=this.buckets;for(let a=1;a<5;a++){const c=Math.floor(i*a/5),l=t.getRow(c,this.luminances),d=Math.floor(e*4/5);for(let u=Math.floor(e/5);u<d;u++){const f=l[u]&255;o[f>>y.LUMINANCE_SHIFT]++}}const n=y.estimateBlackPoint(o),r=t.getMatrix();for(let a=0;a<i;a++){const c=a*e;for(let l=0;l<e;l++)(r[c+l]&255)<n&&s.set(l,a)}return s}createBinarizer(t){return new y(t)}initArrays(t){this.luminances.length<t&&(this.luminances=new Uint8ClampedArray(t));const e=this.buckets;for(let i=0;i<y.LUMINANCE_BUCKETS;i++)e[i]=0}static estimateBlackPoint(t){const e=t.length;let i=0,s=0,o=0;for(let l=0;l<e;l++)t[l]>o&&(s=l,o=t[l]),t[l]>i&&(i=t[l]);let n=0,r=0;for(let l=0;l<e;l++){const d=l-s,u=t[l]*d*d;u>r&&(n=l,r=u)}if(s>n){const l=s;s=n,n=l}if(n-s<=e/16)throw new A;let a=n-1,c=-1;for(let l=n-1;l>s;l--){const d=l-s,u=d*d*(n-l)*(i-t[l]);u>c&&(a=l,c=u)}return a<<y.LUMINANCE_SHIFT}}y.LUMINANCE_BITS=5;y.LUMINANCE_SHIFT=8-y.LUMINANCE_BITS;y.LUMINANCE_BUCKETS=1<<y.LUMINANCE_BITS;y.EMPTY=Uint8ClampedArray.from([0]);class w extends y{constructor(t){super(t),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const t=this.getLuminanceSource(),e=t.getWidth(),i=t.getHeight();if(e>=w.MINIMUM_DIMENSION&&i>=w.MINIMUM_DIMENSION){const s=t.getMatrix();let o=e>>w.BLOCK_SIZE_POWER;(e&w.BLOCK_SIZE_MASK)!==0&&o++;let n=i>>w.BLOCK_SIZE_POWER;(i&w.BLOCK_SIZE_MASK)!==0&&n++;const r=w.calculateBlackPoints(s,o,n,e,i),a=new W(e,i);w.calculateThresholdForBlock(s,o,n,e,i,r,a),this.matrix=a}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(t){return new w(t)}static calculateThresholdForBlock(t,e,i,s,o,n,r){const a=o-w.BLOCK_SIZE,c=s-w.BLOCK_SIZE;for(let l=0;l<i;l++){let d=l<<w.BLOCK_SIZE_POWER;d>a&&(d=a);const u=w.cap(l,2,i-3);for(let f=0;f<e;f++){let g=f<<w.BLOCK_SIZE_POWER;g>c&&(g=c);const m=w.cap(f,2,e-3);let p=0;for(let N=-2;N<=2;N++){const S=n[u+N];p+=S[m-2]+S[m-1]+S[m]+S[m+1]+S[m+2]}const C=p/25;w.thresholdBlock(t,g,d,C,s,r)}}}static cap(t,e,i){return t<e?e:t>i?i:t}static thresholdBlock(t,e,i,s,o,n){for(let r=0,a=i*o+e;r<w.BLOCK_SIZE;r++,a+=o)for(let c=0;c<w.BLOCK_SIZE;c++)(t[a+c]&255)<=s&&n.set(e+c,i+r)}static calculateBlackPoints(t,e,i,s,o){const n=o-w.BLOCK_SIZE,r=s-w.BLOCK_SIZE,a=new Array(i);for(let c=0;c<i;c++){a[c]=new Int32Array(e);let l=c<<w.BLOCK_SIZE_POWER;l>n&&(l=n);for(let d=0;d<e;d++){let u=d<<w.BLOCK_SIZE_POWER;u>r&&(u=r);let f=0,g=255,m=0;for(let C=0,N=l*s+u;C<w.BLOCK_SIZE;C++,N+=s){for(let S=0;S<w.BLOCK_SIZE;S++){const _=t[N+S]&255;f+=_,_<g&&(g=_),_>m&&(m=_)}if(m-g>w.MIN_DYNAMIC_RANGE)for(C++,N+=s;C<w.BLOCK_SIZE;C++,N+=s)for(let S=0;S<w.BLOCK_SIZE;S++)f+=t[N+S]&255}let p=f>>w.BLOCK_SIZE_POWER*2;if(m-g<=w.MIN_DYNAMIC_RANGE&&(p=g/2,c>0&&d>0)){const C=(a[c-1][d]+2*a[c][d-1]+a[c-1][d-1])/4;g<C&&(p=C)}a[c][d]=p}}return a}}w.BLOCK_SIZE_POWER=3;w.BLOCK_SIZE=1<<w.BLOCK_SIZE_POWER;w.BLOCK_SIZE_MASK=w.BLOCK_SIZE-1;w.MINIMUM_DIMENSION=w.BLOCK_SIZE*5;w.MIN_DYNAMIC_RANGE=24;class ht{constructor(t,e){this.width=t,this.height=e}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(t,e,i,s){throw new Q("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new Q("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new Q("This luminance source does not support rotation by 45 degrees.")}toString(){const t=new Uint8ClampedArray(this.width);let e=new ct;for(let i=0;i<this.height;i++){const s=this.getRow(i,t);for(let o=0;o<this.width;o++){const n=s[o]&255;let r;n<64?r="#":n<128?r="+":n<192?r=".":r=" ",e.append(r)}e.append(`
`)}return e.toString()}}class P extends ht{constructor(t){super(t.getWidth(),t.getHeight()),this.delegate=t}getRow(t,e){const i=this.delegate.getRow(t,e),s=this.getWidth();for(let o=0;o<s;o++)i[o]=255-(i[o]&255);return i}getMatrix(){const t=this.delegate.getMatrix(),e=this.getWidth()*this.getHeight(),i=new Uint8ClampedArray(e);for(let s=0;s<e;s++)i[s]=255-(t[s]&255);return i}isCropSupported(){return this.delegate.isCropSupported()}crop(t,e,i,s){return new P(this.delegate.crop(t,e,i,s))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new P(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new P(this.delegate.rotateCounterClockwise45())}}class R extends ht{constructor(t){super(t.width,t.height),this.canvas=t,this.tempCanvasElement=null,this.buffer=R.makeBufferFromCanvasImageData(t)}static makeBufferFromCanvasImageData(t){const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return R.toGrayscaleBuffer(e.data,t.width,t.height)}static toGrayscaleBuffer(t,e,i){const s=new Uint8ClampedArray(e*i);for(let o=0,n=0,r=t.length;o<r;o+=4,n++){let a;if(t[o+3]===0)a=255;else{const l=t[o],d=t[o+1],u=t[o+2];a=306*l+601*d+117*u+512>>10}s[n]=a}return s}getRow(t,e){if(t<0||t>=this.getHeight())throw new j("Requested row is outside the image: "+t);const i=this.getWidth(),s=t*i;return e===null?e=this.buffer.slice(s,s+i):(e.length<i&&(e=new Uint8ClampedArray(i)),e.set(this.buffer.slice(s,s+i))),e}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(t,e,i,s){return super.crop(t,e,i,s),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const t=this.canvas.ownerDocument.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height,this.tempCanvasElement=t}return this.tempCanvasElement}rotate(t){const e=this.getTempCanvasElement(),i=e.getContext("2d"),s=t*R.DEGREE_TO_RADIANS,o=this.canvas.width,n=this.canvas.height,r=Math.ceil(Math.abs(Math.cos(s))*o+Math.abs(Math.sin(s))*n),a=Math.ceil(Math.abs(Math.sin(s))*o+Math.abs(Math.cos(s))*n);return e.width=r,e.height=a,i.translate(r/2,a/2),i.rotate(s),i.drawImage(this.canvas,o/-2,n/-2),this.buffer=R.makeBufferFromCanvasImageData(e),this}invert(){return new P(this)}}R.DEGREE_TO_RADIANS=Math.PI/180;class pt{constructor(t,e,i){this.deviceId=t,this.label=e,this.kind="videoinput",this.groupId=i||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var b=globalThis&&globalThis.__awaiter||function(h,t,e,i){return new(e||(e=Promise))(function(s,o){function n(c){try{a(i.next(c))}catch(l){o(l)}}function r(c){try{a(i.throw(c))}catch(l){o(l)}}function a(c){c.done?s(c.value):new e(function(l){l(c.value)}).then(n,r)}a((i=i.apply(h,t||[])).next())})};class Ct{constructor(t,e=500,i){this.reader=t,this.timeBetweenScansMillis=e,this._hints=i,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(t){this._timeBetweenDecodingAttempts=t<0?0:t}set hints(t){this._hints=t||null}get hints(){return this._hints}listVideoInputDevices(){return b(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const t=yield navigator.mediaDevices.enumerateDevices(),e=[];for(const i of t){const s=i.kind==="video"?"videoinput":i.kind;if(s!=="videoinput")continue;const o=i.deviceId||i.id,n=i.label||`Video device ${e.length+1}`,r=i.groupId,a={deviceId:o,label:n,kind:s,groupId:r};e.push(a)}return e})}getVideoInputDevices(){return b(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(e=>new pt(e.deviceId,e.label))})}findDeviceById(t){return b(this,void 0,void 0,function*(){const e=yield this.listVideoInputDevices();return e?e.find(i=>i.deviceId===t):null})}decodeFromInputVideoDevice(t,e){return b(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(t,e)})}decodeOnceFromVideoDevice(t,e){return b(this,void 0,void 0,function*(){this.reset();let i;t?i={deviceId:{exact:t}}:i={facingMode:"environment"};const s={video:i};return yield this.decodeOnceFromConstraints(s,e)})}decodeOnceFromConstraints(t,e){return b(this,void 0,void 0,function*(){const i=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeOnceFromStream(i,e)})}decodeOnceFromStream(t,e){return b(this,void 0,void 0,function*(){this.reset();const i=yield this.attachStreamToVideo(t,e);return yield this.decodeOnce(i)})}decodeFromInputVideoDeviceContinuously(t,e,i){return b(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(t,e,i)})}decodeFromVideoDevice(t,e,i){return b(this,void 0,void 0,function*(){let s;t?s={deviceId:{exact:t}}:s={facingMode:"environment"};const o={video:s};return yield this.decodeFromConstraints(o,e,i)})}decodeFromConstraints(t,e,i){return b(this,void 0,void 0,function*(){const s=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeFromStream(s,e,i)})}decodeFromStream(t,e,i){return b(this,void 0,void 0,function*(){this.reset();const s=yield this.attachStreamToVideo(t,e);return yield this.decodeContinuously(s,i)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(t,e){return b(this,void 0,void 0,function*(){const i=this.prepareVideoElement(e);return this.addVideoSource(i,t),this.videoElement=i,this.stream=t,yield this.playVideoOnLoadAsync(i),i})}playVideoOnLoadAsync(t){return new Promise((e,i)=>this.playVideoOnLoad(t,()=>e()))}playVideoOnLoad(t,e){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(t),t.addEventListener("ended",this.videoEndedListener),t.addEventListener("canplay",this.videoCanPlayListener),t.addEventListener("playing",e),this.tryPlayVideo(t)}isVideoPlaying(t){return t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}tryPlayVideo(t){return b(this,void 0,void 0,function*(){if(this.isVideoPlaying(t)){console.warn("Trying to play video that is already playing.");return}try{yield t.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(t,e){const i=document.getElementById(t);if(!i)throw new D(`element with id '${t}' not found`);if(i.nodeName.toLowerCase()!==e.toLowerCase())throw new D(`element with id '${t}' must be an ${e} element`);return i}decodeFromImage(t,e){if(!t&&!e)throw new D("either imageElement with a src set or an url must be provided");return e&&!t?this.decodeFromImageUrl(e):this.decodeFromImageElement(t)}decodeFromVideo(t,e){if(!t&&!e)throw new D("Either an element with a src set or an URL must be provided");return e&&!t?this.decodeFromVideoUrl(e):this.decodeFromVideoElement(t)}decodeFromVideoContinuously(t,e,i){if(t===void 0&&e===void 0)throw new D("Either an element with a src set or an URL must be provided");return e&&!t?this.decodeFromVideoUrlContinuously(e,i):this.decodeFromVideoElementContinuously(t,i)}decodeFromImageElement(t){if(!t)throw new D("An image element must be provided.");this.reset();const e=this.prepareImageElement(t);this.imageElement=e;let i;return this.isImageLoaded(e)?i=this.decodeOnce(e,!1,!0):i=this._decodeOnLoadImage(e),i}decodeFromVideoElement(t){const e=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideo(e)}decodeFromVideoElementContinuously(t,e){const i=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideoContinuously(i,e)}_decodeFromVideoElementSetup(t){if(!t)throw new D("A video element must be provided.");this.reset();const e=this.prepareVideoElement(t);return this.videoElement=e,e}decodeFromImageUrl(t){if(!t)throw new D("An URL must be provided.");this.reset();const e=this.prepareImageElement();this.imageElement=e;const i=this._decodeOnLoadImage(e);return e.src=t,i}decodeFromVideoUrl(t){if(!t)throw new D("An URL must be provided.");this.reset();const e=this.prepareVideoElement(),i=this.decodeFromVideoElement(e);return e.src=t,i}decodeFromVideoUrlContinuously(t,e){if(!t)throw new D("An URL must be provided.");this.reset();const i=this.prepareVideoElement(),s=this.decodeFromVideoElementContinuously(i,e);return i.src=t,s}_decodeOnLoadImage(t){return new Promise((e,i)=>{this.imageLoadedListener=()=>this.decodeOnce(t,!1,!0).then(e,i),t.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(t){return b(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(t),yield this.decodeOnce(t)})}_decodeOnLoadVideoContinuously(t,e){return b(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(t),this.decodeContinuously(t,e)})}isImageLoaded(t){return!(!t.complete||t.naturalWidth===0)}prepareImageElement(t){let e;return typeof t>"u"&&(e=document.createElement("img"),e.width=200,e.height=200),typeof t=="string"&&(e=this.getMediaElement(t,"img")),t instanceof HTMLImageElement&&(e=t),e}prepareVideoElement(t){let e;return!t&&typeof document<"u"&&(e=document.createElement("video"),e.width=200,e.height=200),typeof t=="string"&&(e=this.getMediaElement(t,"video")),t instanceof HTMLVideoElement&&(e=t),e.setAttribute("autoplay","true"),e.setAttribute("muted","true"),e.setAttribute("playsinline","true"),e}decodeOnce(t,e=!0,i=!0){this._stopAsyncDecode=!1;const s=(o,n)=>{if(this._stopAsyncDecode){n(new A("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const r=this.decode(t);o(r)}catch(r){const a=e&&r instanceof A,l=(r instanceof U||r instanceof E)&&i;if(a||l)return setTimeout(s,this._timeBetweenDecodingAttempts,o,n);n(r)}};return new Promise((o,n)=>s(o,n))}decodeContinuously(t,e){this._stopContinuousDecode=!1;const i=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const s=this.decode(t);e(s,null),setTimeout(i,this.timeBetweenScansMillis)}catch(s){e(null,s);const o=s instanceof U||s instanceof E,n=s instanceof A;(o||n)&&setTimeout(i,this._timeBetweenDecodingAttempts)}};i()}decode(t){const e=this.createBinaryBitmap(t);return this.decodeBitmap(e)}createBinaryBitmap(t){const e=this.getCaptureCanvasContext(t);this.drawImageOnCanvas(e,t);const i=this.getCaptureCanvas(t),s=new R(i),o=new w(s);return new L(o)}getCaptureCanvasContext(t){if(!this.captureCanvasContext){const i=this.getCaptureCanvas(t).getContext("2d");this.captureCanvasContext=i}return this.captureCanvasContext}getCaptureCanvas(t){if(!this.captureCanvas){const e=this.createCaptureCanvas(t);this.captureCanvas=e}return this.captureCanvas}drawImageOnCanvas(t,e){t.drawImage(e,0,0)}decodeBitmap(t){return this.reader.decode(t,this._hints)}createCaptureCanvas(t){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const e=document.createElement("canvas");let i,s;return typeof t<"u"&&(t instanceof HTMLVideoElement?(i=t.videoWidth,s=t.videoHeight):t instanceof HTMLImageElement&&(i=t.naturalWidth||t.width,s=t.naturalHeight||t.height)),e.style.width=i+"px",e.style.height=s+"px",e.width=i,e.height=s,e}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(t=>t.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){!this.videoElement||(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){!this.imageElement||(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(t,e){try{t.srcObject=e}catch{t.src=URL.createObjectURL(e)}}cleanVideoSource(t){try{t.srcObject=null}catch{t.src=""}this.videoElement.removeAttribute("src")}}var J;(function(h){h[h.AZTEC=0]="AZTEC",h[h.CODABAR=1]="CODABAR",h[h.CODE_39=2]="CODE_39",h[h.CODE_93=3]="CODE_93",h[h.CODE_128=4]="CODE_128",h[h.DATA_MATRIX=5]="DATA_MATRIX",h[h.EAN_8=6]="EAN_8",h[h.EAN_13=7]="EAN_13",h[h.ITF=8]="ITF",h[h.MAXICODE=9]="MAXICODE",h[h.PDF_417=10]="PDF_417",h[h.QR_CODE=11]="QR_CODE",h[h.RSS_14=12]="RSS_14",h[h.RSS_EXPANDED=13]="RSS_EXPANDED",h[h.UPC_A=14]="UPC_A",h[h.UPC_E=15]="UPC_E",h[h.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(J||(J={}));const Et=J;class At{constructor(t,e,i=e==null?0:8*e.length,s,o,n=z.currentTimeMillis()){this.text=t,this.rawBytes=e,this.numBits=i,this.resultPoints=s,this.format=o,this.timestamp=n,this.text=t,this.rawBytes=e,i==null?this.numBits=e==null?0:8*e.length:this.numBits=i,this.resultPoints=s,this.format=o,this.resultMetadata=null,n==null?this.timestamp=z.currentTimeMillis():this.timestamp=n}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(t,e){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(t,e)}putAllMetadata(t){t!==null&&(this.resultMetadata===null?this.resultMetadata=t:this.resultMetadata=new Map(t))}addResultPoints(t){const e=this.resultPoints;if(e===null)this.resultPoints=t;else if(t!==null&&t.length>0){const i=new Array(e.length+t.length);z.arraycopy(e,0,i,0,e.length),z.arraycopy(t,0,i,e.length,t.length),this.resultPoints=i}}getTimestamp(){return this.timestamp}toString(){return this.text}}var tt;(function(h){h[h.OTHER=0]="OTHER",h[h.ORIENTATION=1]="ORIENTATION",h[h.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",h[h.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",h[h.ISSUE_NUMBER=4]="ISSUE_NUMBER",h[h.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",h[h.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",h[h.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",h[h.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",h[h.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",h[h.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(tt||(tt={}));const Z=tt;class G extends it{}class Mt{constructor(t){this.field=t}decode(t,e){const i=this.field,s=new rt(i,t),o=new Int32Array(e);let n=!0;for(let f=0;f<e;f++){const g=s.evaluateAt(i.exp(f+i.getGeneratorBase()));o[o.length-1-f]=g,g!==0&&(n=!1)}if(n)return;const r=new rt(i,o),a=this.runEuclideanAlgorithm(i.buildMonomial(e,1),r,e),c=a[0],l=a[1],d=this.findErrorLocations(c),u=this.findErrorMagnitudes(l,d);for(let f=0;f<d.length;f++){const g=t.length-1-i.log(d[f]);if(g<0)throw new G("Bad error location");t[g]=lt.addOrSubtract(t[g],u[f])}}runEuclideanAlgorithm(t,e,i){if(t.getDegree()<e.getDegree()){const f=t;t=e,e=f}const s=this.field;let o=t,n=e,r=s.getZero(),a=s.getOne();for(;n.getDegree()>=(i/2|0);){let f=o,g=r;if(o=n,r=a,o.isZero())throw new G("r_{i-1} was zero");n=f;let m=s.getZero();const p=o.getCoefficient(o.getDegree()),C=s.inverse(p);for(;n.getDegree()>=o.getDegree()&&!n.isZero();){const N=n.getDegree()-o.getDegree(),S=s.multiply(n.getCoefficient(n.getDegree()),C);m=m.addOrSubtract(s.buildMonomial(N,S)),n=n.addOrSubtract(o.multiplyByMonomial(N,S))}if(a=m.multiply(r).addOrSubtract(g),n.getDegree()>=o.getDegree())throw new ft("Division algorithm failed to reduce polynomial?")}const c=a.getCoefficient(0);if(c===0)throw new G("sigmaTilde(0) was zero");const l=s.inverse(c),d=a.multiplyScalar(l),u=n.multiplyScalar(l);return[d,u]}findErrorLocations(t){const e=t.getDegree();if(e===1)return Int32Array.from([t.getCoefficient(1)]);const i=new Int32Array(e);let s=0;const o=this.field;for(let n=1;n<o.getSize()&&s<e;n++)t.evaluateAt(n)===0&&(i[s]=o.inverse(n),s++);if(s!==e)throw new G("Error locator degree does not match number of roots");return i}findErrorMagnitudes(t,e){const i=e.length,s=new Int32Array(i),o=this.field;for(let n=0;n<i;n++){const r=o.inverse(e[n]);let a=1;for(let c=0;c<i;c++)if(n!==c){const l=o.multiply(e[c],r),d=(l&1)===0?l|1:l&-2;a=o.multiply(a,d)}s[n]=o.multiply(t.evaluateAt(r),o.inverse(a)),o.getGeneratorBase()!==0&&(s[n]=o.multiply(s[n],r))}return s}}var I;(function(h){h[h.DATA_MASK_000=0]="DATA_MASK_000",h[h.DATA_MASK_001=1]="DATA_MASK_001",h[h.DATA_MASK_010=2]="DATA_MASK_010",h[h.DATA_MASK_011=3]="DATA_MASK_011",h[h.DATA_MASK_100=4]="DATA_MASK_100",h[h.DATA_MASK_101=5]="DATA_MASK_101",h[h.DATA_MASK_110=6]="DATA_MASK_110",h[h.DATA_MASK_111=7]="DATA_MASK_111"})(I||(I={}));class T{constructor(t,e){this.value=t,this.isMasked=e}unmaskBitMatrix(t,e){for(let i=0;i<e;i++)for(let s=0;s<e;s++)this.isMasked(i,s)&&t.flip(s,i)}}T.values=new Map([[I.DATA_MASK_000,new T(I.DATA_MASK_000,(h,t)=>(h+t&1)===0)],[I.DATA_MASK_001,new T(I.DATA_MASK_001,(h,t)=>(h&1)===0)],[I.DATA_MASK_010,new T(I.DATA_MASK_010,(h,t)=>t%3===0)],[I.DATA_MASK_011,new T(I.DATA_MASK_011,(h,t)=>(h+t)%3===0)],[I.DATA_MASK_100,new T(I.DATA_MASK_100,(h,t)=>(Math.floor(h/2)+Math.floor(t/3)&1)===0)],[I.DATA_MASK_101,new T(I.DATA_MASK_101,(h,t)=>h*t%6===0)],[I.DATA_MASK_110,new T(I.DATA_MASK_110,(h,t)=>h*t%6<3)],[I.DATA_MASK_111,new T(I.DATA_MASK_111,(h,t)=>(h+t+h*t%3&1)===0)]]);class St{constructor(t){const e=t.getHeight();if(e<21||(e&3)!==1)throw new E;this.bitMatrix=t}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let t=0;for(let o=0;o<6;o++)t=this.copyBit(o,8,t);t=this.copyBit(7,8,t),t=this.copyBit(8,8,t),t=this.copyBit(8,7,t);for(let o=5;o>=0;o--)t=this.copyBit(8,o,t);const e=this.bitMatrix.getHeight();let i=0;const s=e-7;for(let o=e-1;o>=s;o--)i=this.copyBit(8,o,i);for(let o=e-8;o<e;o++)i=this.copyBit(o,8,i);if(this.parsedFormatInfo=gt.decodeFormatInformation(t,i),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new E}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const t=this.bitMatrix.getHeight(),e=Math.floor((t-17)/4);if(e<=6)return X.getVersionForNumber(e);let i=0;const s=t-11;for(let n=5;n>=0;n--)for(let r=t-9;r>=s;r--)i=this.copyBit(r,n,i);let o=X.decodeVersionInformation(i);if(o!==null&&o.getDimensionForVersion()===t)return this.parsedVersion=o,o;i=0;for(let n=5;n>=0;n--)for(let r=t-9;r>=s;r--)i=this.copyBit(n,r,i);if(o=X.decodeVersionInformation(i),o!==null&&o.getDimensionForVersion()===t)return this.parsedVersion=o,o;throw new E}copyBit(t,e,i){return(this.isMirror?this.bitMatrix.get(e,t):this.bitMatrix.get(t,e))?i<<1|1:i<<1}readCodewords(){const t=this.readFormatInformation(),e=this.readVersion(),i=T.values.get(t.getDataMask()),s=this.bitMatrix.getHeight();i.unmaskBitMatrix(this.bitMatrix,s);const o=e.buildFunctionPattern();let n=!0;const r=new Uint8Array(e.getTotalCodewords());let a=0,c=0,l=0;for(let d=s-1;d>0;d-=2){d===6&&d--;for(let u=0;u<s;u++){const f=n?s-1-u:u;for(let g=0;g<2;g++)o.get(d-g,f)||(l++,c<<=1,this.bitMatrix.get(d-g,f)&&(c|=1),l===8&&(r[a++]=c,l=0,c=0))}n=!n}if(a!==e.getTotalCodewords())throw new E;return r}remask(){if(this.parsedFormatInfo===null)return;const t=T.values[this.parsedFormatInfo.getDataMask()],e=this.bitMatrix.getHeight();t.unmaskBitMatrix(this.bitMatrix,e)}setMirror(t){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=t}mirror(){const t=this.bitMatrix;for(let e=0,i=t.getWidth();e<i;e++)for(let s=e+1,o=t.getHeight();s<o;s++)t.get(e,s)!==t.get(s,e)&&(t.flip(s,e),t.flip(e,s))}}class dt{constructor(t){this.mirrored=t}isMirrored(){return this.mirrored}applyMirroredCorrection(t){if(!this.mirrored||t===null||t.length<3)return;const e=t[0];t[0]=t[2],t[2]=e}}class st{constructor(t,e){this.numDataCodewords=t,this.codewords=e}static getDataBlocks(t,e,i){if(t.length!==e.getTotalCodewords())throw new j;const s=e.getECBlocksForLevel(i);let o=0;const n=s.getECBlocks();for(const g of n)o+=g.getCount();const r=new Array(o);let a=0;for(const g of n)for(let m=0;m<g.getCount();m++){const p=g.getDataCodewords(),C=s.getECCodewordsPerBlock()+p;r[a++]=new st(p,new Uint8Array(C))}const c=r[0].codewords.length;let l=r.length-1;for(;l>=0&&r[l].codewords.length!==c;)l--;l++;const d=c-s.getECCodewordsPerBlock();let u=0;for(let g=0;g<d;g++)for(let m=0;m<a;m++)r[m].codewords[g]=t[u++];for(let g=l;g<a;g++)r[g].codewords[d]=t[u++];const f=r[0].codewords.length;for(let g=d;g<f;g++)for(let m=0;m<a;m++){const p=m<l?g:g+1;r[m].codewords[p]=t[u++]}return r}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Nt{constructor(t){this.bytes=t,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(t){if(t<1||t>32||t>this.available())throw new j(""+t);let e=0,i=this.bitOffset,s=this.byteOffset;const o=this.bytes;if(i>0){const n=8-i,r=t<n?t:n,a=n-r,c=255>>8-r<<a;e=(o[s]&c)>>a,t-=r,i+=r,i===8&&(i=0,s++)}if(t>0){for(;t>=8;)e=e<<8|o[s]&255,s++,t-=8;if(t>0){const n=8-t,r=255>>n<<n;e=e<<t|(o[s]&r)>>n,i+=t}}return this.bitOffset=i,this.byteOffset=s,e}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}class It{constructor(t,e,i,s,o=-1,n=-1){this.rawBytes=t,this.text=e,this.byteSegments=i,this.ecLevel=s,this.structuredAppendSequenceNumber=o,this.structuredAppendParity=n,this.numBits=t==null?0:8*t.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(t){this.numBits=t}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(t){this.errorsCorrected=t}getErasures(){return this.erasures}setErasures(t){this.erasures=t}getOther(){return this.other}setOther(t){this.other=t}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class M{static decode(t,e,i,s){const o=new Nt(t);let n=new ct;const r=new Array;let a=-1,c=-1;try{let l=null,d=!1,u;do{if(o.available()<4)u=x.TERMINATOR;else{const f=o.readBits(4);u=x.forBits(f)}switch(u){case x.TERMINATOR:break;case x.FNC1_FIRST_POSITION:case x.FNC1_SECOND_POSITION:d=!0;break;case x.STRUCTURED_APPEND:if(o.available()<16)throw new E;a=o.readBits(8),c=o.readBits(8);break;case x.ECI:const f=M.parseECIValue(o);if(l=mt.getCharacterSetECIByValue(f),l===null)throw new E;break;case x.HANZI:const g=o.readBits(4),m=o.readBits(u.getCharacterCountBits(e));g===M.GB2312_SUBSET&&M.decodeHanziSegment(o,n,m);break;default:const p=o.readBits(u.getCharacterCountBits(e));switch(u){case x.NUMERIC:M.decodeNumericSegment(o,n,p);break;case x.ALPHANUMERIC:M.decodeAlphanumericSegment(o,n,p,d);break;case x.BYTE:M.decodeByteSegment(o,n,p,l,r,s);break;case x.KANJI:M.decodeKanjiSegment(o,n,p);break;default:throw new E}break}}while(u!==x.TERMINATOR)}catch{throw new E}return new It(t,n.toString(),r.length===0?null:r,i===null?null:i.toString(),a,c)}static decodeHanziSegment(t,e,i){if(i*13>t.available())throw new E;const s=new Uint8Array(2*i);let o=0;for(;i>0;){const n=t.readBits(13);let r=n/96<<8&4294967295|n%96;r<959?r+=41377:r+=42657,s[o]=r>>8&255,s[o+1]=r&255,o+=2,i--}try{e.append(H.decode(s,$.GB2312))}catch(n){throw new E(n)}}static decodeKanjiSegment(t,e,i){if(i*13>t.available())throw new E;const s=new Uint8Array(2*i);let o=0;for(;i>0;){const n=t.readBits(13);let r=n/192<<8&4294967295|n%192;r<7936?r+=33088:r+=49472,s[o]=r>>8,s[o+1]=r,o+=2,i--}try{e.append(H.decode(s,$.SHIFT_JIS))}catch(n){throw new E(n)}}static decodeByteSegment(t,e,i,s,o,n){if(8*i>t.available())throw new E;const r=new Uint8Array(i);for(let c=0;c<i;c++)r[c]=t.readBits(8);let a;s===null?a=$.guessEncoding(r,n):a=s.getName();try{e.append(H.decode(r,a))}catch(c){throw new E(c)}o.push(r)}static toAlphaNumericChar(t){if(t>=M.ALPHANUMERIC_CHARS.length)throw new E;return M.ALPHANUMERIC_CHARS[t]}static decodeAlphanumericSegment(t,e,i,s){const o=e.length();for(;i>1;){if(t.available()<11)throw new E;const n=t.readBits(11);e.append(M.toAlphaNumericChar(Math.floor(n/45))),e.append(M.toAlphaNumericChar(n%45)),i-=2}if(i===1){if(t.available()<6)throw new E;e.append(M.toAlphaNumericChar(t.readBits(6)))}if(s)for(let n=o;n<e.length();n++)e.charAt(n)==="%"&&(n<e.length()-1&&e.charAt(n+1)==="%"?e.deleteCharAt(n+1):e.setCharAt(n,String.fromCharCode(29)))}static decodeNumericSegment(t,e,i){for(;i>=3;){if(t.available()<10)throw new E;const s=t.readBits(10);if(s>=1e3)throw new E;e.append(M.toAlphaNumericChar(Math.floor(s/100))),e.append(M.toAlphaNumericChar(Math.floor(s/10)%10)),e.append(M.toAlphaNumericChar(s%10)),i-=3}if(i===2){if(t.available()<7)throw new E;const s=t.readBits(7);if(s>=100)throw new E;e.append(M.toAlphaNumericChar(Math.floor(s/10))),e.append(M.toAlphaNumericChar(s%10))}else if(i===1){if(t.available()<4)throw new E;const s=t.readBits(4);if(s>=10)throw new E;e.append(M.toAlphaNumericChar(s))}}static parseECIValue(t){const e=t.readBits(8);if((e&128)===0)return e&127;if((e&192)===128){const i=t.readBits(8);return(e&63)<<8&4294967295|i}if((e&224)===192){const i=t.readBits(16);return(e&31)<<16&4294967295|i}throw new E}}M.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";M.GB2312_SUBSET=1;class vt{constructor(){this.rsDecoder=new Mt(lt.QR_CODE_FIELD_256)}decodeBooleanArray(t,e){return this.decodeBitMatrix(W.parseFromBooleanArray(t),e)}decodeBitMatrix(t,e){const i=new St(t);let s=null;try{return this.decodeBitMatrixParser(i,e)}catch(o){s=o}try{i.remask(),i.setMirror(!0),i.readVersion(),i.readFormatInformation(),i.mirror();const o=this.decodeBitMatrixParser(i,e);return o.setOther(new dt(!0)),o}catch(o){throw s!==null?s:o}}decodeBitMatrixParser(t,e){const i=t.readVersion(),s=t.readFormatInformation().getErrorCorrectionLevel(),o=t.readCodewords(),n=st.getDataBlocks(o,i,s);let r=0;for(const l of n)r+=l.getNumDataCodewords();const a=new Uint8Array(r);let c=0;for(const l of n){const d=l.getCodewords(),u=l.getNumDataCodewords();this.correctErrors(d,u);for(let f=0;f<u;f++)a[c++]=d[f]}return M.decode(a,i,s,e)}correctErrors(t,e){t.length;const i=new Int32Array(t);try{this.rsDecoder.decode(i,t.length-e)}catch{throw new U}for(let s=0;s<e;s++)t[s]=i[s]}}class B{MathUtils(){}static round(t){return t===NaN?0:t<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:t>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t+(t<0?-.5:.5)|0}static distance(t,e,i,s){const o=t-i,n=e-s;return Math.sqrt(o*o+n*n)}static sum(t){let e=0;for(let i=0,s=t.length;i!==s;i++)e+=t[i];return e}}class et{static floatToIntBits(t){return t}}et.MAX_VALUE=Number.MAX_SAFE_INTEGER;class k{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}getY(){return this.y}equals(t){if(t instanceof k){const e=t;return this.x===e.x&&this.y===e.y}return!1}hashCode(){return 31*et.floatToIntBits(this.x)+et.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(t){const e=this.distance(t[0],t[1]),i=this.distance(t[1],t[2]),s=this.distance(t[0],t[2]);let o,n,r;if(i>=e&&i>=s?(n=t[0],o=t[1],r=t[2]):s>=i&&s>=e?(n=t[1],o=t[0],r=t[2]):(n=t[2],o=t[0],r=t[1]),this.crossProductZ(o,n,r)<0){const a=o;o=r,r=a}t[0]=o,t[1]=n,t[2]=r}static distance(t,e){return B.distance(t.x,t.y,e.x,e.y)}static crossProductZ(t,e,i){const s=e.x,o=e.y;return(i.x-s)*(t.y-o)-(i.y-o)*(t.x-s)}}class yt{constructor(t,e){this.bits=t,this.points=e}getBits(){return this.bits}getPoints(){return this.points}}class at{static checkAndNudgePoints(t,e){const i=t.getWidth(),s=t.getHeight();let o=!0;for(let n=0;n<e.length&&o;n+=2){const r=Math.floor(e[n]),a=Math.floor(e[n+1]);if(r<-1||r>i||a<-1||a>s)throw new A;o=!1,r===-1?(e[n]=0,o=!0):r===i&&(e[n]=i-1,o=!0),a===-1?(e[n+1]=0,o=!0):a===s&&(e[n+1]=s-1,o=!0)}o=!0;for(let n=e.length-2;n>=0&&o;n-=2){const r=Math.floor(e[n]),a=Math.floor(e[n+1]);if(r<-1||r>i||a<-1||a>s)throw new A;o=!1,r===-1?(e[n]=0,o=!0):r===i&&(e[n]=i-1,o=!0),a===-1?(e[n+1]=0,o=!0):a===s&&(e[n+1]=s-1,o=!0)}}}class O{constructor(t,e,i,s,o,n,r,a,c){this.a11=t,this.a21=e,this.a31=i,this.a12=s,this.a22=o,this.a32=n,this.a13=r,this.a23=a,this.a33=c}static quadrilateralToQuadrilateral(t,e,i,s,o,n,r,a,c,l,d,u,f,g,m,p){const C=O.quadrilateralToSquare(t,e,i,s,o,n,r,a);return O.squareToQuadrilateral(c,l,d,u,f,g,m,p).times(C)}transformPoints(t){const e=t.length,i=this.a11,s=this.a12,o=this.a13,n=this.a21,r=this.a22,a=this.a23,c=this.a31,l=this.a32,d=this.a33;for(let u=0;u<e;u+=2){const f=t[u],g=t[u+1],m=o*f+a*g+d;t[u]=(i*f+n*g+c)/m,t[u+1]=(s*f+r*g+l)/m}}transformPointsWithValues(t,e){const i=this.a11,s=this.a12,o=this.a13,n=this.a21,r=this.a22,a=this.a23,c=this.a31,l=this.a32,d=this.a33,u=t.length;for(let f=0;f<u;f++){const g=t[f],m=e[f],p=o*g+a*m+d;t[f]=(i*g+n*m+c)/p,e[f]=(s*g+r*m+l)/p}}static squareToQuadrilateral(t,e,i,s,o,n,r,a){const c=t-i+o-r,l=e-s+n-a;if(c===0&&l===0)return new O(i-t,o-i,t,s-e,n-s,e,0,0,1);{const d=i-o,u=r-o,f=s-n,g=a-n,m=d*g-u*f,p=(c*g-u*l)/m,C=(d*l-c*f)/m;return new O(i-t+p*i,r-t+C*r,t,s-e+p*s,a-e+C*a,e,p,C,1)}}static quadrilateralToSquare(t,e,i,s,o,n,r,a){return O.squareToQuadrilateral(t,e,i,s,o,n,r,a).buildAdjoint()}buildAdjoint(){return new O(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(t){return new O(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)}}class bt extends at{sampleGrid(t,e,i,s,o,n,r,a,c,l,d,u,f,g,m,p,C,N,S){const _=O.quadrilateralToQuadrilateral(s,o,n,r,a,c,l,d,u,f,g,m,p,C,N,S);return this.sampleGridWithTransform(t,e,i,_)}sampleGridWithTransform(t,e,i,s){if(e<=0||i<=0)throw new A;const o=new W(e,i),n=new Float32Array(2*e);for(let r=0;r<i;r++){const a=n.length,c=r+.5;for(let l=0;l<a;l+=2)n[l]=l/2+.5,n[l+1]=c;s.transformPoints(n),at.checkAndNudgePoints(t,n);try{for(let l=0;l<a;l+=2)t.get(Math.floor(n[l]),Math.floor(n[l+1]))&&o.set(l/2,r)}catch{throw new A}}return o}}class V{static setGridSampler(t){V.gridSampler=t}static getInstance(){return V.gridSampler}}V.gridSampler=new bt;class nt extends k{constructor(t,e,i,s){super(t,e),this.estimatedModuleSize=i,this.count=s,s===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(t,e,i){if(Math.abs(e-this.getY())<=t&&Math.abs(i-this.getX())<=t){const s=Math.abs(t-this.estimatedModuleSize);return s<=1||s<=this.estimatedModuleSize}return!1}combineEstimate(t,e,i){const s=this.count+1,o=(this.count*this.getX()+e)/s,n=(this.count*this.getY()+t)/s,r=(this.count*this.estimatedModuleSize+i)/s;return new nt(o,n,r,s)}}class xt{constructor(t){this.bottomLeft=t[0],this.topLeft=t[1],this.topRight=t[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class v{constructor(t,e){this.image=t,this.resultPointCallback=e,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=e}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(t){const e=t!=null&&t.get(Y.TRY_HARDER)!==void 0,i=t!=null&&t.get(Y.PURE_BARCODE)!==void 0,s=this.image,o=s.getHeight(),n=s.getWidth();let r=Math.floor(3*o/(4*v.MAX_MODULES));(r<v.MIN_SKIP||e)&&(r=v.MIN_SKIP);let a=!1;const c=new Int32Array(5);for(let d=r-1;d<o&&!a;d+=r){c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0;let u=0;for(let f=0;f<n;f++)if(s.get(f,d))(u&1)===1&&u++,c[u]++;else if((u&1)===0)if(u===4)if(v.foundPatternCross(c)){if(this.handlePossibleCenter(c,d,f,i)===!0)if(r=2,this.hasSkipped===!0)a=this.haveMultiplyConfirmedCenters();else{const m=this.findRowSkip();m>c[2]&&(d+=m-c[2]-r,f=n-1)}else{c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,u=3;continue}u=0,c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0}else c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,u=3;else c[++u]++;else c[u]++;v.foundPatternCross(c)&&this.handlePossibleCenter(c,d,n,i)===!0&&(r=c[0],this.hasSkipped&&(a=this.haveMultiplyConfirmedCenters()))}const l=this.selectBestPatterns();return k.orderBestPatterns(l),new xt(l)}static centerFromEnd(t,e){return e-t[4]-t[3]-t[2]/2}static foundPatternCross(t){let e=0;for(let o=0;o<5;o++){const n=t[o];if(n===0)return!1;e+=n}if(e<7)return!1;const i=e/7,s=i/2;return Math.abs(i-t[0])<s&&Math.abs(i-t[1])<s&&Math.abs(3*i-t[2])<3*s&&Math.abs(i-t[3])<s&&Math.abs(i-t[4])<s}getCrossCheckStateCount(){const t=this.crossCheckStateCount;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t}crossCheckDiagonal(t,e,i,s){const o=this.getCrossCheckStateCount();let n=0;const r=this.image;for(;t>=n&&e>=n&&r.get(e-n,t-n);)o[2]++,n++;if(t<n||e<n)return!1;for(;t>=n&&e>=n&&!r.get(e-n,t-n)&&o[1]<=i;)o[1]++,n++;if(t<n||e<n||o[1]>i)return!1;for(;t>=n&&e>=n&&r.get(e-n,t-n)&&o[0]<=i;)o[0]++,n++;if(o[0]>i)return!1;const a=r.getHeight(),c=r.getWidth();for(n=1;t+n<a&&e+n<c&&r.get(e+n,t+n);)o[2]++,n++;if(t+n>=a||e+n>=c)return!1;for(;t+n<a&&e+n<c&&!r.get(e+n,t+n)&&o[3]<i;)o[3]++,n++;if(t+n>=a||e+n>=c||o[3]>=i)return!1;for(;t+n<a&&e+n<c&&r.get(e+n,t+n)&&o[4]<i;)o[4]++,n++;if(o[4]>=i)return!1;const l=o[0]+o[1]+o[2]+o[3]+o[4];return Math.abs(l-s)<2*s&&v.foundPatternCross(o)}crossCheckVertical(t,e,i,s){const o=this.image,n=o.getHeight(),r=this.getCrossCheckStateCount();let a=t;for(;a>=0&&o.get(e,a);)r[2]++,a--;if(a<0)return NaN;for(;a>=0&&!o.get(e,a)&&r[1]<=i;)r[1]++,a--;if(a<0||r[1]>i)return NaN;for(;a>=0&&o.get(e,a)&&r[0]<=i;)r[0]++,a--;if(r[0]>i)return NaN;for(a=t+1;a<n&&o.get(e,a);)r[2]++,a++;if(a===n)return NaN;for(;a<n&&!o.get(e,a)&&r[3]<i;)r[3]++,a++;if(a===n||r[3]>=i)return NaN;for(;a<n&&o.get(e,a)&&r[4]<i;)r[4]++,a++;if(r[4]>=i)return NaN;const c=r[0]+r[1]+r[2]+r[3]+r[4];return 5*Math.abs(c-s)>=2*s?NaN:v.foundPatternCross(r)?v.centerFromEnd(r,a):NaN}crossCheckHorizontal(t,e,i,s){const o=this.image,n=o.getWidth(),r=this.getCrossCheckStateCount();let a=t;for(;a>=0&&o.get(a,e);)r[2]++,a--;if(a<0)return NaN;for(;a>=0&&!o.get(a,e)&&r[1]<=i;)r[1]++,a--;if(a<0||r[1]>i)return NaN;for(;a>=0&&o.get(a,e)&&r[0]<=i;)r[0]++,a--;if(r[0]>i)return NaN;for(a=t+1;a<n&&o.get(a,e);)r[2]++,a++;if(a===n)return NaN;for(;a<n&&!o.get(a,e)&&r[3]<i;)r[3]++,a++;if(a===n||r[3]>=i)return NaN;for(;a<n&&o.get(a,e)&&r[4]<i;)r[4]++,a++;if(r[4]>=i)return NaN;const c=r[0]+r[1]+r[2]+r[3]+r[4];return 5*Math.abs(c-s)>=s?NaN:v.foundPatternCross(r)?v.centerFromEnd(r,a):NaN}handlePossibleCenter(t,e,i,s){const o=t[0]+t[1]+t[2]+t[3]+t[4];let n=v.centerFromEnd(t,i),r=this.crossCheckVertical(e,Math.floor(n),t[2],o);if(!isNaN(r)&&(n=this.crossCheckHorizontal(Math.floor(n),Math.floor(r),t[2],o),!isNaN(n)&&(!s||this.crossCheckDiagonal(Math.floor(r),Math.floor(n),t[2],o)))){const a=o/7;let c=!1;const l=this.possibleCenters;for(let d=0,u=l.length;d<u;d++){const f=l[d];if(f.aboutEquals(a,r,n)){l[d]=f.combineEstimate(r,n,a),c=!0;break}}if(!c){const d=new nt(n,r,a);l.push(d),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(d)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let e=null;for(const i of this.possibleCenters)if(i.getCount()>=v.CENTER_QUORUM)if(e==null)e=i;else return this.hasSkipped=!0,Math.floor((Math.abs(e.getX()-i.getX())-Math.abs(e.getY()-i.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let t=0,e=0;const i=this.possibleCenters.length;for(const n of this.possibleCenters)n.getCount()>=v.CENTER_QUORUM&&(t++,e+=n.getEstimatedModuleSize());if(t<3)return!1;const s=e/i;let o=0;for(const n of this.possibleCenters)o+=Math.abs(n.getEstimatedModuleSize()-s);return o<=.05*e}selectBestPatterns(){const t=this.possibleCenters.length;if(t<3)throw new A;const e=this.possibleCenters;let i;if(t>3){let s=0,o=0;for(const a of this.possibleCenters){const c=a.getEstimatedModuleSize();s+=c,o+=c*c}i=s/t;let n=Math.sqrt(o/t-i*i);e.sort((a,c)=>{const l=Math.abs(c.getEstimatedModuleSize()-i),d=Math.abs(a.getEstimatedModuleSize()-i);return l<d?-1:l>d?1:0});const r=Math.max(.2*i,n);for(let a=0;a<e.length&&e.length>3;a++){const c=e[a];Math.abs(c.getEstimatedModuleSize()-i)>r&&(e.splice(a,1),a--)}}if(e.length>3){let s=0;for(const o of e)s+=o.getEstimatedModuleSize();i=s/e.length,e.sort((o,n)=>{if(n.getCount()===o.getCount()){const r=Math.abs(n.getEstimatedModuleSize()-i),a=Math.abs(o.getEstimatedModuleSize()-i);return r<a?1:r>a?-1:0}else return n.getCount()-o.getCount()}),e.splice(3)}return[e[0],e[1],e[2]]}}v.CENTER_QUORUM=2;v.MIN_SKIP=3;v.MAX_MODULES=57;class ot extends k{constructor(t,e,i){super(t,e),this.estimatedModuleSize=i}aboutEquals(t,e,i){if(Math.abs(e-this.getY())<=t&&Math.abs(i-this.getX())<=t){const s=Math.abs(t-this.estimatedModuleSize);return s<=1||s<=this.estimatedModuleSize}return!1}combineEstimate(t,e,i){const s=(this.getX()+e)/2,o=(this.getY()+t)/2,n=(this.estimatedModuleSize+i)/2;return new ot(s,o,n)}}class q{constructor(t,e,i,s,o,n,r){this.image=t,this.startX=e,this.startY=i,this.width=s,this.height=o,this.moduleSize=n,this.resultPointCallback=r,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const t=this.startX,e=this.height,i=this.width,s=t+i,o=this.startY+e/2,n=new Int32Array(3),r=this.image;for(let a=0;a<e;a++){const c=o+((a&1)===0?Math.floor((a+1)/2):-Math.floor((a+1)/2));n[0]=0,n[1]=0,n[2]=0;let l=t;for(;l<s&&!r.get(l,c);)l++;let d=0;for(;l<s;){if(r.get(l,c))if(d===1)n[1]++;else if(d===2){if(this.foundPatternCross(n)){const u=this.handlePossibleCenter(n,c,l);if(u!==null)return u}n[0]=n[2],n[1]=1,n[2]=0,d=1}else n[++d]++;else d===1&&d++,n[d]++;l++}if(this.foundPatternCross(n)){const u=this.handlePossibleCenter(n,c,s);if(u!==null)return u}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new A}static centerFromEnd(t,e){return e-t[2]-t[1]/2}foundPatternCross(t){const e=this.moduleSize,i=e/2;for(let s=0;s<3;s++)if(Math.abs(e-t[s])>=i)return!1;return!0}crossCheckVertical(t,e,i,s){const o=this.image,n=o.getHeight(),r=this.crossCheckStateCount;r[0]=0,r[1]=0,r[2]=0;let a=t;for(;a>=0&&o.get(e,a)&&r[1]<=i;)r[1]++,a--;if(a<0||r[1]>i)return NaN;for(;a>=0&&!o.get(e,a)&&r[0]<=i;)r[0]++,a--;if(r[0]>i)return NaN;for(a=t+1;a<n&&o.get(e,a)&&r[1]<=i;)r[1]++,a++;if(a===n||r[1]>i)return NaN;for(;a<n&&!o.get(e,a)&&r[2]<=i;)r[2]++,a++;if(r[2]>i)return NaN;const c=r[0]+r[1]+r[2];return 5*Math.abs(c-s)>=2*s?NaN:this.foundPatternCross(r)?q.centerFromEnd(r,a):NaN}handlePossibleCenter(t,e,i){const s=t[0]+t[1]+t[2],o=q.centerFromEnd(t,i),n=this.crossCheckVertical(e,o,2*t[1],s);if(!isNaN(n)){const r=(t[0]+t[1]+t[2])/3;for(const c of this.possibleCenters)if(c.aboutEquals(r,n,o))return c.combineEstimate(n,o,r);const a=new ot(o,n,r);this.possibleCenters.push(a),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(a)}return null}}class F{constructor(t){this.image=t}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(t){this.resultPointCallback=t==null?null:t.get(Y.NEED_RESULT_POINT_CALLBACK);const i=new v(this.image,this.resultPointCallback).find(t);return this.processFinderPatternInfo(i)}processFinderPatternInfo(t){const e=t.getTopLeft(),i=t.getTopRight(),s=t.getBottomLeft(),o=this.calculateModuleSize(e,i,s);if(o<1)throw new A("No pattern found in proccess finder.");const n=F.computeDimension(e,i,s,o),r=X.getProvisionalVersionForDimension(n),a=r.getDimensionForVersion()-7;let c=null;if(r.getAlignmentPatternCenters().length>0){const f=i.getX()-e.getX()+s.getX(),g=i.getY()-e.getY()+s.getY(),m=1-3/a,p=Math.floor(e.getX()+m*(f-e.getX())),C=Math.floor(e.getY()+m*(g-e.getY()));for(let N=4;N<=16;N<<=1)try{c=this.findAlignmentInRegion(o,p,C,N);break}catch(S){if(!(S instanceof A))throw S}}const l=F.createTransform(e,i,s,c,n),d=F.sampleGrid(this.image,l,n);let u;return c===null?u=[s,e,i]:u=[s,e,i,c],new yt(d,u)}static createTransform(t,e,i,s,o){const n=o-3.5;let r,a,c,l;return s!==null?(r=s.getX(),a=s.getY(),c=n-3,l=c):(r=e.getX()-t.getX()+i.getX(),a=e.getY()-t.getY()+i.getY(),c=n,l=n),O.quadrilateralToQuadrilateral(3.5,3.5,n,3.5,c,l,3.5,n,t.getX(),t.getY(),e.getX(),e.getY(),r,a,i.getX(),i.getY())}static sampleGrid(t,e,i){return V.getInstance().sampleGridWithTransform(t,i,i,e)}static computeDimension(t,e,i,s){const o=B.round(k.distance(t,e)/s),n=B.round(k.distance(t,i)/s);let r=Math.floor((o+n)/2)+7;switch(r&3){case 0:r++;break;case 2:r--;break;case 3:throw new A("Dimensions could be not found.")}return r}calculateModuleSize(t,e,i){return(this.calculateModuleSizeOneWay(t,e)+this.calculateModuleSizeOneWay(t,i))/2}calculateModuleSizeOneWay(t,e){const i=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY())),s=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY()));return isNaN(i)?s/7:isNaN(s)?i/7:(i+s)/14}sizeOfBlackWhiteBlackRunBothWays(t,e,i,s){let o=this.sizeOfBlackWhiteBlackRun(t,e,i,s),n=1,r=t-(i-t);r<0?(n=t/(t-r),r=0):r>=this.image.getWidth()&&(n=(this.image.getWidth()-1-t)/(r-t),r=this.image.getWidth()-1);let a=Math.floor(e-(s-e)*n);return n=1,a<0?(n=e/(e-a),a=0):a>=this.image.getHeight()&&(n=(this.image.getHeight()-1-e)/(a-e),a=this.image.getHeight()-1),r=Math.floor(t+(r-t)*n),o+=this.sizeOfBlackWhiteBlackRun(t,e,r,a),o-1}sizeOfBlackWhiteBlackRun(t,e,i,s){const o=Math.abs(s-e)>Math.abs(i-t);if(o){let f=t;t=e,e=f,f=i,i=s,s=f}const n=Math.abs(i-t),r=Math.abs(s-e);let a=-n/2;const c=t<i?1:-1,l=e<s?1:-1;let d=0;const u=i+c;for(let f=t,g=e;f!==u;f+=c){const m=o?g:f,p=o?f:g;if(d===1===this.image.get(m,p)){if(d===2)return B.distance(f,g,t,e);d++}if(a+=r,a>0){if(g===s)break;g+=l,a-=n}}return d===2?B.distance(i+c,s,t,e):NaN}findAlignmentInRegion(t,e,i,s){const o=Math.floor(s*t),n=Math.max(0,e-o),r=Math.min(this.image.getWidth()-1,e+o);if(r-n<t*3)throw new A("Alignment top exceeds estimated module size.");const a=Math.max(0,i-o),c=Math.min(this.image.getHeight()-1,i+o);if(c-a<t*3)throw new A("Alignment bottom exceeds estimated module size.");return new q(this.image,n,a,r-n,c-a,t,this.resultPointCallback).find()}}class K{constructor(){this.decoder=new vt}getDecoder(){return this.decoder}decode(t,e){let i,s;if(e!=null&&e.get(Y.PURE_BARCODE)!==void 0){const a=K.extractPureBits(t.getBlackMatrix());i=this.decoder.decodeBitMatrix(a,e),s=K.NO_POINTS}else{const a=new F(t.getBlackMatrix()).detect(e);i=this.decoder.decodeBitMatrix(a.getBits(),e),s=a.getPoints()}i.getOther()instanceof dt&&i.getOther().applyMirroredCorrection(s);const o=new At(i.getText(),i.getRawBytes(),void 0,s,Et.QR_CODE,void 0),n=i.getByteSegments();n!==null&&o.putMetadata(Z.BYTE_SEGMENTS,n);const r=i.getECLevel();return r!==null&&o.putMetadata(Z.ERROR_CORRECTION_LEVEL,r),i.hasStructuredAppend()&&(o.putMetadata(Z.STRUCTURED_APPEND_SEQUENCE,i.getStructuredAppendSequenceNumber()),o.putMetadata(Z.STRUCTURED_APPEND_PARITY,i.getStructuredAppendParity())),o}reset(){}static extractPureBits(t){const e=t.getTopLeftOnBit(),i=t.getBottomRightOnBit();if(e===null||i===null)throw new A;const s=this.moduleSize(e,t);let o=e[1],n=i[1],r=e[0],a=i[0];if(r>=a||o>=n)throw new A;if(n-o!==a-r&&(a=r+(n-o),a>=t.getWidth()))throw new A;const c=Math.round((a-r+1)/s),l=Math.round((n-o+1)/s);if(c<=0||l<=0)throw new A;if(l!==c)throw new A;const d=Math.floor(s/2);o+=d,r+=d;const u=r+Math.floor((c-1)*s)-a;if(u>0){if(u>d)throw new A;r-=u}const f=o+Math.floor((l-1)*s)-n;if(f>0){if(f>d)throw new A;o-=f}const g=new W(c,l);for(let m=0;m<l;m++){const p=o+Math.floor(m*s);for(let C=0;C<c;C++)t.get(r+Math.floor(C*s),p)&&g.set(C,m)}return g}static moduleSize(t,e){const i=e.getHeight(),s=e.getWidth();let o=t[0],n=t[1],r=!0,a=0;for(;o<s&&n<i;){if(r!==e.get(o,n)){if(++a===5)break;r=!r}o++,n++}if(o===s||n===i)throw new A;return(o-t[0])/7}}K.NO_POINTS=new Array;class Dt extends Ct{constructor(t=500){super(new K,t)}}export{Dt as BrowserQRCodeReader};
